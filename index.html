<!DOCTYPE html>
<html>
  <head>
    <script src="./lib/vue.js"></script>
    <script src="./lib/mousetrap.js"></script>
    <script src="./lib/_.js"></script>
    <script src="./lib/sprintf.js"></script>
    <link rel="stylesheet" href="./app/style/base.scss">
  </head>

  <body>
    <div id="wrap">
      <h1>{{ segment_time }}</h1>
    </div>
  </body>

  <script>
    const ipc = require('electron').ipcRenderer;

    let timerStarted = false;

    let vm = new Vue({
      el: '#wrap',
      data: {
        start_time: null,
        end_time: null,
        now: null
      },
      computed: {
        segment_time: function() {
          let dur = this.now - this.start_time,
              ms  = ~~(dur % 1000),
              s   = ~~(dur / 1000) % 60,
              m   = ~~(dur / (1000*60)) % 60,
              h   = ~~(dur / (1000*60*24)) % 24;

          if(h) {
            return sprintf("%d:%02d:%02d.%03d", h, m, s, ms);
          } else if(m) {
            return sprintf("%2d:%02d.%03d", m, s, ms);
          } else {
            return sprintf("%2d.%03d", s, ms);
            return s + '.' + ms.toPrecision(3);
          }
        }
      }
    });

    let itv;
    vm.start_time = new Date();
    vm.now = vm.start_time;

    let timerRunning = false;
    Mousetrap.bind('space', function() {
      if(!timerRunning) {
        vm.start_time = new Date();
        // Update on hundredths
        itv = setInterval(function() {
          vm.now = new Date();
        }, 100);
        timerRunning = true;
      }
    });

    Mousetrap.bind('p', function() {
      clearInterval(itv);
      timerRunning = false;
    });
  </script>
</html>

