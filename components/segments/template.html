<link rel="stylesheet" href="./segments.scss">

<template id="segments_component">
  <div class="segments">
    <div rv-each-segment="visible_segments < run.segments | call run.segment_idx" class="segment" rv-class-active="segment.active">
      <span class="table-cell segment-name">{ segment.name }</span>
      <span class="table-cell time segment-time">{ segment.elapsed_time | time }</span>
      <span class="table-cell time total-time">{ segment.time_in_run < elapsed_time started_at | call | time }</span>
    </div>
  </div>
</template>

<script>
  var segments_template_str = document.currentScript.ownerDocument.querySelector('#segments_component').innerHTML;

  class SegmentsComponent {
    constructor(data) {
      this.run = data.run;
    };

    visible_segments() {
      let last_seg = Math.min(this.run.segments.length, Math.max(this.run.segment_idx + 4, 10));
      let first_seg = last_seg - 10;
      return this.run.segments.slice(first_seg, last_seg);
    };

    is_active(segment) {
      return this.run.current_segment == segment;
    };
  };

  rivets.components['segments'] = {
    template: function() {
      return segments_template_str;
    },

    initialize: function(el, data) {
      return new SegmentsComponent(data);
    }
  };
</script>
