function sightglass(a,b,c,d){return new Observer(a,b,c,d)}function Observer(a,b,c,d){this.options=d||{},this.options.adapters=this.options.adapters||{},this.obj=a,this.keypath=b,this.callback=c,this.objectPath=[],this.update=this.update.bind(this),this.parse(),isObject(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function isObject(a){return"object"==typeof a&&null!==a}function error(a){throw new Error("[sightglass] "+a)}sightglass.adapters={},Observer.tokenize=function(a,b,c){var f,g,d=[],e={i:c,path:""};for(f=0;f<a.length;f++)g=a.charAt(f),~b.indexOf(g)?(d.push(e),e={i:g,path:""}):e.path+=g;return d.push(e),d},Observer.prototype.parse=function(){var b,c,a=this.interfaces();a.length||error("Must define at least one adapter interface."),~a.indexOf(this.keypath[0])?(b=this.keypath[0],c=this.keypath.substr(1)):(void 0===(b=this.options.root||sightglass.root)&&error("Must define a default root adapter."),c=this.keypath),this.tokens=Observer.tokenize(c,a,b),this.key=this.tokens.pop()},Observer.prototype.realize=function(){var c,a=this.obj,b=!1;return this.tokens.forEach(function(d,e){isObject(a)?(void 0!==this.objectPath[e]?a!==(c=this.objectPath[e])&&(this.set(!1,d,c,this.update),this.set(!0,d,a,this.update),this.objectPath[e]=a):(this.set(!0,d,a,this.update),this.objectPath[e]=a),a=this.get(d,a)):(!1===b&&(b=e),(c=this.objectPath[e])&&this.set(!1,d,c,this.update))},this),!1!==b&&this.objectPath.splice(b),a},Observer.prototype.update=function(){var a,b;(a=this.realize())!==this.target&&(isObject(this.target)&&this.set(!1,this.key,this.target,this.callback),isObject(a)&&this.set(!0,this.key,a,this.callback),b=this.value(),this.target=a,(this.value()instanceof Function||this.value()!==b)&&this.callback())},Observer.prototype.value=function(){if(isObject(this.target))return this.get(this.key,this.target)},Observer.prototype.setValue=function(a){isObject(this.target)&&this.adapter(this.key).set(this.target,this.key.path,a)},Observer.prototype.get=function(a,b){return this.adapter(a).get(b,a.path)},Observer.prototype.set=function(a,b,c,d){var e=a?"observe":"unobserve";this.adapter(b)[e](c,b.path,d)},Observer.prototype.interfaces=function(){var a=Object.keys(this.options.adapters);return Object.keys(sightglass.adapters).forEach(function(b){~a.indexOf(b)||a.push(b)}),a},Observer.prototype.adapter=function(a){return this.options.adapters[a.i]||sightglass.adapters[a.i]},Observer.prototype.unobserve=function(){var a;this.tokens.forEach(function(b,c){(a=this.objectPath[c])&&this.set(!1,b,a,this.update)},this),isObject(this.target)&&this.set(!1,this.key,this.target,this.callback)};
var Rivets,bindMethod,jQuery,unbindMethod,_ref,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Rivets={options:["prefix","templateDelimiters","rootInterface","preloadData","handler","executeFunctions"],extensions:["binders","formatters","components","adapters"],public:{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,executeFunctions:!1,iterationAlias:function(a){return"%"+a+"%"},handler:function(a,b,c){return this.call(a,b,c.view.models)},configure:function(a){var b,c,d,e;null==a&&(a={});for(d in a)if(e=a[d],"binders"===d||"components"===d||"formatters"===d||"adapters"===d)for(c in e)b=e[c],Rivets[d][c]=b;else Rivets.public[d]=e},bind:function(a,b,c){var d;return null==b&&(b={}),null==c&&(c={}),d=new Rivets.View(a,b,c),d.bind(),d},init:function(a,b,c){var d,e,f;if(null==c&&(c={}),null==b&&(b=document.createElement("div")),a=Rivets.public.components[a],(e=a.template.call(this,b))instanceof HTMLElement){for(;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(e)}else b.innerHTML=e;return d=a.initialize.call(this,b,c),f=new Rivets.View(b,d),f.bind(),f}}},window.jQuery||window.$?(jQuery=window.jQuery||window.$,_ref="on"in jQuery.prototype?["on","off"]:["bind","unbind"],bindMethod=_ref[0],unbindMethod=_ref[1],Rivets.Util={bindEvent:function(a,b,c){return jQuery(a)[bindMethod](b,c)},unbindEvent:function(a,b,c){return jQuery(a)[unbindMethod](b,c)},getInputValue:function(a){var b;return b=jQuery(a),"checkbox"===b.attr("type")?b.is(":checked"):b.val()}}):Rivets.Util={bindEvent:function(){return"addEventListener"in window?function(a,b,c){return a.addEventListener(b,c,!1)}:function(a,b,c){return a.attachEvent("on"+b,c)}}(),unbindEvent:function(){return"removeEventListener"in window?function(a,b,c){return a.removeEventListener(b,c,!1)}:function(a,b,c){return a.detachEvent("on"+b,c)}}(),getInputValue:function(a){var b,c,d,e;if("checkbox"===a.type)return a.checked;if("select-multiple"===a.type){for(e=[],c=0,d=a.length;c<d;c++)b=a[c],b.selected&&e.push(b.value);return e}return a.value}},Rivets.TypeParser=function(){function a(){}return a.types={primitive:0,keypath:1},a.parse=function(a){return/^'.*'$|^".*"$/.test(a)?{type:this.types.primitive,value:a.slice(1,-1)}:"true"===a?{type:this.types.primitive,value:!0}:"false"===a?{type:this.types.primitive,value:!1}:"null"===a?{type:this.types.primitive,value:null}:"undefined"===a?{type:this.types.primitive,value:void 0}:""===a?{type:this.types.primitive,value:void 0}:!1===isNaN(Number(a))?{type:this.types.primitive,value:Number(a)}:{type:this.types.keypath,value:a}},a}(),Rivets.TextTemplateParser=function(){function a(){}return a.types={text:0,binding:1},a.parse=function(a,b){var c,d,e,f,g,h,i;for(h=[],f=a.length,c=0,d=0;d<f;){if((c=a.indexOf(b[0],d))<0){h.push({type:this.types.text,value:a.slice(d)});break}if(c>0&&d<c&&h.push({type:this.types.text,value:a.slice(d,c)}),d=c+b[0].length,(c=a.indexOf(b[1],d))<0){g=a.slice(d-b[1].length),e=h[h.length-1],(null!=e?e.type:void 0)===this.types.text?e.value+=g:h.push({type:this.types.text,value:g});break}i=a.slice(d,c).trim(),h.push({type:this.types.binding,value:i}),d=c+b[1].length}return h},a}(),Rivets.View=function(){function a(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;for(this.els=a,this.models=b,null==c&&(c={}),this.update=__bind(this.update,this),this.publish=__bind(this.publish,this),this.sync=__bind(this.sync,this),this.unbind=__bind(this.unbind,this),this.bind=__bind(this.bind,this),this.select=__bind(this.select,this),this.traverse=__bind(this.traverse,this),this.build=__bind(this.build,this),this.buildBinding=__bind(this.buildBinding,this),this.bindingRegExp=__bind(this.bindingRegExp,this),this.options=__bind(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),l=Rivets.extensions,h=0,j=l.length;h<j;h++){if(e=l[h],this[e]={},c[e]){m=c[e];for(d in m)f=m[d],this[e][d]=f}n=Rivets.public[e];for(d in n)f=n[d],null==(g=this[e])[d]&&(g[d]=f)}for(o=Rivets.options,i=0,k=o.length;i<k;i++)e=o[i],this[e]=null!=(p=c[e])?p:Rivets.public[e];this.build()}return a.prototype.options=function(){var a,b,c,d,e;for(b={},e=Rivets.extensions.concat(Rivets.options),c=0,d=e.length;c<d;c++)a=e[c],b[a]=this[a];return b},a.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},a.prototype.buildBinding=function(a,b,c,d){var e,f,g,h,i,j,k;return i={},k=function(){var a,b,c,e;for(c=d.match(/((?:'[^']*')*(?:(?:[^\|']*(?:'[^']*')+[^\|']*)+|[^\|]+))|^$/g),e=[],a=0,b=c.length;a<b;a++)j=c[a],e.push(j.trim());return e}(),e=function(){var a,b,c,d;for(c=k.shift().split("<"),d=[],a=0,b=c.length;a<b;a++)f=c[a],d.push(f.trim());return d}(),h=e.shift(),i.formatters=k,(g=e.shift())&&(i.dependencies=g.split(/\s+/)),this.bindings.push(new Rivets[a](this,b,c,h,i))},a.prototype.build=function(){var a,b,c,d,e;for(this.bindings=[],b=function(a){return function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p;if(3===c.nodeType){if(h=Rivets.TextTemplateParser,(f=a.templateDelimiters)&&(k=h.parse(c.data,f)).length&&(1!==k.length||k[0].type!==h.types.text)){for(l=0,n=k.length;l<n;l++)j=k[l],i=document.createTextNode(j.value),c.parentNode.insertBefore(i,c),1===j.type&&a.buildBinding("TextBinding",i,null,j.value);c.parentNode.removeChild(c)}}else 1===c.nodeType&&(d=a.traverse(c));if(!d)for(p=function(){var a,b,d,e;for(d=c.childNodes,e=[],a=0,b=d.length;a<b;a++)g=d[a],e.push(g);return e}(),m=0,o=p.length;m<o;m++)e=p[m],b(e)}}(this),e=this.els,c=0,d=e.length;c<d;c++)a=e[c],b(a);this.bindings.sort(function(a,b){var c,d;return((null!=(c=b.binder)?c.priority:void 0)||0)-((null!=(d=a.binder)?d.priority:void 0)||0)})},a.prototype.traverse=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(e=this.bindingRegExp(),f="SCRIPT"===a.nodeName||"STYLE"===a.nodeName,o=a.attributes,k=0,m=o.length;k<m;k++)if(b=o[k],e.test(b.name)){if(i=b.name.replace(e,""),!(d=this.binders[i])){p=this.binders;for(g in p)j=p[g],"*"!==g&&-1!==g.indexOf("*")&&(h=new RegExp("^"+g.replace(/\*/g,".+")+"$"),h.test(i)&&(d=j))}d||(d=this.binders["*"]),d.block&&(f=!0,c=[b])}for(q=c||a.attributes,l=0,n=q.length;l<n;l++)b=q[l],e.test(b.name)&&(i=b.name.replace(e,""),this.buildBinding("Binding",a,i,b.value));return f||(i=a.nodeName.toLowerCase(),this.components[i]&&!a._bound&&(this.bindings.push(new Rivets.ComponentBinding(this,a,i)),f=!0)),f},a.prototype.select=function(a){var b,c,d,e,f;for(e=this.bindings,f=[],c=0,d=e.length;c<d;c++)b=e[c],a(b)&&f.push(b);return f},a.prototype.bind=function(){var a,b,c,d;for(d=this.bindings,b=0,c=d.length;b<c;b++)a=d[b],a.bind()},a.prototype.unbind=function(){var a,b,c,d;for(d=this.bindings,b=0,c=d.length;b<c;b++)a=d[b],a.unbind()},a.prototype.sync=function(){var a,b,c,d;for(d=this.bindings,b=0,c=d.length;b<c;b++)a=d[b],"function"==typeof a.sync&&a.sync()},a.prototype.publish=function(){var a,b,c,d;for(d=this.select(function(a){var b;return null!=(b=a.binder)?b.publishes:void 0}),b=0,c=d.length;b<c;b++)a=d[b],a.publish()},a.prototype.update=function(a){var b,c,d,e,f,g;null==a&&(a={});for(c in a)d=a[c],this.models[c]=d;for(g=this.bindings,e=0,f=g.length;e<f;e++)b=g[e],"function"==typeof b.update&&b.update(a)},a}(),Rivets.Binding=function(){function a(a,b,c,d,e){this.view=a,this.el=b,this.type=c,this.keypath=d,this.options=null!=e?e:{},this.getValue=__bind(this.getValue,this),this.update=__bind(this.update,this),this.unbind=__bind(this.unbind,this),this.bind=__bind(this.bind,this),this.publish=__bind(this.publish,this),this.sync=__bind(this.sync,this),this.set=__bind(this.set,this),this.eventHandler=__bind(this.eventHandler,this),this.formattedValue=__bind(this.formattedValue,this),this.parseFormatterArguments=__bind(this.parseFormatterArguments,this),this.parseTarget=__bind(this.parseTarget,this),this.observe=__bind(this.observe,this),this.setBinder=__bind(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return a.prototype.setBinder=function(){var a,b,c,d;if(!(this.binder=this.view.binders[this.type])){d=this.view.binders;for(a in d)c=d[a],"*"!==a&&-1!==a.indexOf("*")&&(b=new RegExp("^"+a.replace(/\*/g,".+")+"$"),b.test(this.type)&&(this.binder=c,this.args=new RegExp("^"+a.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift()))}if(this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function)return this.binder={routine:this.binder}},a.prototype.observe=function(a,b,c){return Rivets.sightglass(a,b,c,{root:this.view.rootInterface,adapters:this.view.adapters})},a.prototype.parseTarget=function(){var a;return a=Rivets.TypeParser.parse(this.keypath),a.type===Rivets.TypeParser.types.primitive?this.value=a.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},a.prototype.parseFormatterArguments=function(a,b){var c,d,e,f,g,h,i;for(a=function(){var b,c,e;for(e=[],b=0,c=a.length;b<c;b++)d=a[b],e.push(Rivets.TypeParser.parse(d));return e}(),f=[],c=h=0,i=a.length;h<i;c=++h)d=a[c],f.push(d.type===Rivets.TypeParser.types.primitive?d.value:((g=this.formatterObservers)[b]||(g[b]={}),(e=this.formatterObservers[b][c])||(e=this.observe(this.view.models,d.value,this.sync),this.formatterObservers[b][c]=e),e.value()));return f},a.prototype.formattedValue=function(a){var b,c,d,e,f,g,h,i,j;for(i=this.formatters,c=g=0,h=i.length;g<h;c=++g)d=i[c],b=d.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),e=b.shift(),d=this.view.formatters[e],f=this.parseFormatterArguments(b,c),(null!=d?d.read:void 0)instanceof Function?a=(j=d.read).call.apply(j,[this.model,a].concat(__slice.call(f))):d instanceof Function&&(a=d.call.apply(d,[this.model,a].concat(__slice.call(f))));return a},a.prototype.eventHandler=function(a){var b,c;return c=(b=this).view.handler,function(d){return c.call(a,this,d,b)}},a.prototype.set=function(a){var b;return a=a instanceof Function&&!this.binder.function&&Rivets.public.executeFunctions?this.formattedValue(a.call(this.model)):this.formattedValue(a),null!=(b=this.binder.routine)?b.call(this,this.el,a):void 0},a.prototype.sync=function(){var a,b;return this.set(function(){var c,d,e,f,g,h,i;if(this.observer){if(this.model!==this.observer.target){for(g=this.dependencies,c=0,e=g.length;c<e;c++)b=g[c],b.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(h=this.options.dependencies)?h.length:void 0))for(i=this.options.dependencies,d=0,f=i.length;d<f;d++)a=i[d],b=this.observe(this.model,a,this.sync),this.dependencies.push(b)}return this.observer.value()}return this.value}.call(this))},a.prototype.publish=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(this.observer){for(h=this.getValue(this.el),f=this.formatters.length-1,k=this.formatters.slice(0).reverse(),c=i=0,j=k.length;i<j;c=++i)d=k[c],b=f-c,a=d.split(/\s+/),e=a.shift(),g=this.parseFormatterArguments(a,b),(null!=(l=this.view.formatters[e])?l.publish:void 0)&&(h=(m=this.view.formatters[e]).publish.apply(m,[h].concat(__slice.call(g))));return this.observer.setValue(h)}},a.prototype.bind=function(){var a,b,c,d,e,f,g;if(this.parseTarget(),null!=(e=this.binder.bind)&&e.call(this,this.el),null!=this.model&&(null!=(f=this.options.dependencies)?f.length:void 0))for(g=this.options.dependencies,c=0,d=g.length;c<d;c++)a=g[c],b=this.observe(this.model,a,this.sync),this.dependencies.push(b);if(this.view.preloadData)return this.sync()},a.prototype.unbind=function(){var a,b,c,d,e,f,g,h,i,j;for(null!=(g=this.binder.unbind)&&g.call(this,this.el),null!=(h=this.observer)&&h.unobserve(),i=this.dependencies,e=0,f=i.length;e<f;e++)d=i[e],d.unobserve();this.dependencies=[],j=this.formatterObservers;for(c in j){b=j[c];for(a in b)d=b[a],d.unobserve()}return this.formatterObservers={}},a.prototype.update=function(a){var b,c;return null==a&&(a={}),this.model=null!=(b=this.observer)?b.target:void 0,null!=(c=this.binder.update)?c.call(this,a):void 0},a.prototype.getValue=function(a){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,a):Rivets.Util.getInputValue(a)},a}(),Rivets.ComponentBinding=function(a){function b(a,b,c){var d,e,f,g,h,i,j,k;for(this.view=a,this.el=b,this.type=c,this.unbind=__bind(this.unbind,this),this.bind=__bind(this.bind,this),this.locals=__bind(this.locals,this),this.component=this.view.components[this.type],this.static={},this.observers={},this.upstreamObservers={},e=a.bindingRegExp(),j=this.el.attributes||[],h=0,i=j.length;h<i;h++)d=j[h],e.test(d.name)||(f=this.camelCase(d.name),g=Rivets.TypeParser.parse(d.value),__indexOf.call(null!=(k=this.component.static)?k:[],f)>=0?this.static[f]=d.value:g.type===Rivets.TypeParser.types.primitive?this.static[f]=g.value:this.observers[f]=d.value)}return __extends(b,a),b.prototype.sync=function(){},b.prototype.update=function(){},b.prototype.publish=function(){},b.prototype.locals=function(){var a,b,c,d,e,f;c={},e=this.static;for(a in e)d=e[a],c[a]=d;f=this.observers;for(a in f)b=f[a],c[a]=b.value();return c},b.prototype.camelCase=function(a){return a.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},b.prototype.bind=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(!this.bound){n=this.observers;for(b in n)c=n[b],this.observers[b]=this.observe(this.view.models,c,function(a){return function(b){return function(){return a.componentView.models[b]=a.observers[b].value()}}}(this).call(this,b));this.bound=!0}if(null!=this.componentView)this.componentView.bind();else{for(this.el.innerHTML=this.component.template.call(this),g=this.component.initialize.call(this,this.el,this.locals()),this.el._bound=!0,f={},o=Rivets.extensions,j=0,l=o.length;j<l;j++){if(e=o[j],f[e]={},this.component[e]){p=this.component[e];for(a in p)h=p[a],f[e][a]=h}q=this.view[e];for(a in q)h=q[a],null==(i=f[e])[a]&&(i[a]=h)}for(r=Rivets.options,k=0,m=r.length;k<m;k++)e=r[k],f[e]=null!=(s=this.component[e])?s:this.view[e];this.componentView=new Rivets.View(Array.prototype.slice.call(this.el.childNodes),g,f),this.componentView.bind(),t=this.observers;for(b in t)d=t[b],this.upstreamObservers[b]=this.observe(this.componentView.models,b,function(a){return function(b,c){return function(){return c.setValue(a.componentView.models[b])}}}(this).call(this,b,d))}},b.prototype.unbind=function(){var a,b,c,d,e;c=this.upstreamObservers;for(a in c)b=c[a],b.unobserve();d=this.observers;for(a in d)b=d[a],b.unobserve();return null!=(e=this.componentView)?e.unbind.call(this):void 0},b}(Rivets.Binding),Rivets.TextBinding=function(a){function b(a,b,c,d,e){this.view=a,this.el=b,this.type=c,this.keypath=d,this.options=null!=e?e:{},this.sync=__bind(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return __extends(b,a),b.prototype.binder={routine:function(a,b){return a.data=null!=b?b:""}},b.prototype.sync=function(){return b.__super__.sync.apply(this,arguments)},b}(Rivets.Binding),Rivets.public.binders.text=function(a,b){return null!=a.textContent?a.textContent=null!=b?b:"":a.innerText=null!=b?b:""},Rivets.public.binders.html=function(a,b){return a.innerHTML=null!=b?b:""},Rivets.public.binders.show=function(a,b){return a.style.display=b?"":"none"},Rivets.public.binders.hide=function(a,b){return a.style.display=b?"none":""},Rivets.public.binders.enabled=function(a,b){return a.disabled=!b},Rivets.public.binders.disabled=function(a,b){return a.disabled=!!b},Rivets.public.binders.checked={publishes:!0,priority:2e3,bind:function(a){return Rivets.Util.bindEvent(a,"change",this.publish)},unbind:function(a){return Rivets.Util.unbindEvent(a,"change",this.publish)},routine:function(a,b){var c;return"radio"===a.type?a.checked=(null!=(c=a.value)?c.toString():void 0)===(null!=b?b.toString():void 0):a.checked=!!b}},Rivets.public.binders.unchecked={publishes:!0,priority:2e3,bind:function(a){return Rivets.Util.bindEvent(a,"change",this.publish)},unbind:function(a){return Rivets.Util.unbindEvent(a,"change",this.publish)},routine:function(a,b){var c;return"radio"===a.type?a.checked=(null!=(c=a.value)?c.toString():void 0)!==(null!=b?b.toString():void 0):a.checked=!b}},Rivets.public.binders.value={publishes:!0,priority:3e3,bind:function(a){if("INPUT"!==a.tagName||"radio"!==a.type)return this.event="SELECT"===a.tagName?"change":"input",Rivets.Util.bindEvent(a,this.event,this.publish)},unbind:function(a){if("INPUT"!==a.tagName||"radio"!==a.type)return Rivets.Util.unbindEvent(a,this.event,this.publish)},routine:function(a,b){var c,d,e,f,g,h,i;if("INPUT"===a.tagName&&"radio"===a.type)return a.setAttribute("value",b);if(null!=window.jQuery){if(a=jQuery(a),(null!=b?b.toString():void 0)!==(null!=(f=a.val())?f.toString():void 0))return a.val(null!=b?b:"")}else if("select-multiple"===a.type){if(null!=b){for(i=[],d=0,e=a.length;d<e;d++)c=a[d],i.push(c.selected=(g=c.value,__indexOf.call(b,g)>=0));return i}}else if((null!=b?b.toString():void 0)!==(null!=(h=a.value)?h.toString():void 0))return a.value=null!=b?b:""}},Rivets.public.binders.if={block:!0,priority:4e3,bind:function(a){var b,c;if(null==this.marker)return b=[this.view.prefix,this.type].join("-").replace("--","-"),c=a.getAttribute(b),this.marker=document.createComment(" rivets: "+this.type+" "+c+" "),this.bound=!1,a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)},unbind:function(){if(this.nested)return this.nested.unbind(),this.bound=!1},routine:function(a,b){var c,d,e,f;if(!!b==!this.bound){if(b){e={},f=this.view.models;for(c in f)d=f[c],e[c]=d;return(this.nested||(this.nested=new Rivets.View(a,e,this.view.options()))).bind(),this.marker.parentNode.insertBefore(a,this.marker.nextSibling),this.bound=!0}return a.parentNode.removeChild(a),this.nested.unbind(),this.bound=!1}},update:function(a){var b;return null!=(b=this.nested)?b.update(a):void 0}},Rivets.public.binders.unless={block:!0,priority:4e3,bind:function(a){return Rivets.public.binders.if.bind.call(this,a)},unbind:function(){return Rivets.public.binders.if.unbind.call(this)},routine:function(a,b){return Rivets.public.binders.if.routine.call(this,a,!b)},update:function(a){return Rivets.public.binders.if.update.call(this,a)}},Rivets.public.binders["on-*"]={function:!0,priority:1e3,unbind:function(a){if(this.handler)return Rivets.Util.unbindEvent(a,this.args[0],this.handler)},routine:function(a,b){return this.handler&&Rivets.Util.unbindEvent(a,this.args[0],this.handler),Rivets.Util.bindEvent(a,this.args[0],this.handler=this.eventHandler(b))}},Rivets.public.binders["each-*"]={block:!0,priority:4e3,bind:function(a){var b,c,d,e,f;if(null==this.marker)b=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a);else for(f=this.iterated,d=0,e=f.length;d<e;d++)c=f[d],c.bind()},unbind:function(a){var b,c,d,e;if(null!=this.iterated)for(e=this.iterated,c=0,d=e.length;c<d;c++)b=e[c],b.unbind()},routine:function(a,b){var c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(i=this.args[0],b=b||[],this.iterated.length>b.length)for(t=Array(this.iterated.length-b.length),n=0,q=t.length;n<q;n++)t[n],m=this.iterated.pop(),m.unbind(),this.marker.parentNode.removeChild(m.els[0]);for(f=o=0,r=b.length;o<r;f=++o)if(h=b[f],d={index:f},d[Rivets.public.iterationAlias(i)]=f,d[i]=h,null==this.iterated[f]){u=this.view.models;for(g in u)h=u[g],null==d[g]&&(d[g]=h);k=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,j=this.view.options(),j.preloadData=!0,l=a.cloneNode(!0),m=new Rivets.View(l,d,j),m.bind(),this.iterated.push(m),this.marker.parentNode.insertBefore(l,k.nextSibling)}else this.iterated[f].models[i]!==h&&this.iterated[f].update(d);if("OPTION"===a.nodeName)for(v=this.view.bindings,p=0,s=v.length;p<s;p++)c=v[p],c.el===this.marker.parentNode&&"value"===c.type&&c.sync()},update:function(a){var b,c,d,e,f,g,h;b={};for(c in a)d=a[c],c!==this.args[0]&&(b[c]=d);for(h=this.iterated,f=0,g=h.length;f<g;f++)e=h[f],e.update(b)}},Rivets.public.binders["class-*"]=function(a,b){var c;if(c=" "+a.className+" ",!b==(-1!==c.indexOf(" "+this.args[0]+" ")))return a.className=b?a.className+" "+this.args[0]:c.replace(" "+this.args[0]+" "," ").trim()},Rivets.public.binders["*"]=function(a,b){return null!=b?a.setAttribute(this.type,b):a.removeAttribute(this.type)},Rivets.public.formatters.call=function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],b.call.apply(b,[this].concat(__slice.call(a)))},Rivets.public.adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(a){var b,c,d;return a.hasOwnProperty(this.id)||(b=this.counter++,Object.defineProperty(a,this.id,{value:b})),(c=this.weakmap)[d=a[this.id]]||(c[d]={callbacks:{}})},cleanupWeakReference:function(a,b){if(!(Object.keys(a.callbacks).length||a.pointers&&Object.keys(a.pointers).length))return delete this.weakmap[b]},stubFunction:function(a,b){var c,d,e;return d=a[b],c=this.weakReference(a),e=this.weakmap,a[b]=function(){var f,g,h,i,j,k,l,m,n;h=d.apply(a,arguments),k=c.pointers;for(g in k)for(f=k[g],n=null!=(l=null!=(m=e[g])?m.callbacks[f]:void 0)?l:[],i=0,j=n.length;i<j;i++)(0,n[i])();return h}},observeMutations:function(a,b,c){var d,e,f,g,h,i;if(Array.isArray(a)){if(f=this.weakReference(a),null==f.pointers)for(f.pointers={},e=["push","pop","shift","unshift","sort","reverse","splice"],h=0,i=e.length;h<i;h++)d=e[h],this.stubFunction(a,d);if(null==(g=f.pointers)[b]&&(g[b]=[]),__indexOf.call(f.pointers[b],c)<0)return f.pointers[b].push(c)}},unobserveMutations:function(a,b,c){var d,e,f;if(Array.isArray(a)&&null!=a[this.id]&&(e=this.weakmap[a[this.id]])&&(f=e.pointers[b]))return(d=f.indexOf(c))>=0&&f.splice(d,1),f.length||delete e.pointers[b],this.cleanupWeakReference(e,a[this.id])},observe:function(a,b,c){var d,e,f;return d=this.weakReference(a).callbacks,null==d[b]&&(d[b]=[],e=Object.getOwnPropertyDescriptor(a,b),(null!=e?e.get:void 0)||(null!=e?e.set:void 0)||(f=a[b],Object.defineProperty(a,b,{enumerable:!0,get:function(){return f},set:function(c){return function(e){var g,h,i,j,k;if(e!==f&&(c.unobserveMutations(f,a[c.id],b),f=e,h=c.weakmap[a[c.id]])){if(d=h.callbacks,d[b])for(k=d[b].slice(),i=0,j=k.length;i<j;i++)g=k[i],__indexOf.call(d[b],g)>=0&&g();return c.observeMutations(e,a[c.id],b)}}}(this)}))),__indexOf.call(d[b],c)<0&&d[b].push(c),this.observeMutations(a[b],a[this.id],b)},unobserve:function(a,b,c){var d,e,f;if((f=this.weakmap[a[this.id]])&&(d=f.callbacks[b]))return(e=d.indexOf(c))>=0&&(d.splice(e,1),d.length||(delete f.callbacks[b],this.unobserveMutations(a[b],a[this.id],b))),this.cleanupWeakReference(f,a[this.id])},get:function(a,b){return a[b]},set:function(a,b,c){return a[b]=c}},Rivets.factory=function(a){return Rivets.sightglass=a,Rivets.public._=Rivets,Rivets.public};const rivets=Rivets.factory(sightglass);
