<!DOCTYPE html>
<html>
  <head>
    <script src="./lib/rivets.js"></script>
    <script src="./lib/_.js"></script>
    <script src="./lib/sprintf.js"></script>
    <script src="./lib/mousetrap.js"></script>

    <script src="./formatters/time_formatters.js"></script>
    <link rel="stylesheet" href="./style/base.scss">
  </head>

  <body>
    <div id="wrap">
      <div class="timer">
        <span class="time">{ run.timer.elapsed_time | time }</span>
        <div class="clear"></div>
      </div>

      <div class="segments">
        <div rv-each-segment="run.segments" class="segment">
          <span class="segment-name">{ segment.name }</span>
          <span class="segment-time">{ segment.elapsed_time | time }</span>
          <span class="total-time">{ segment.time_in_run < elapsed_time started_at | call | time }</span>
        </div>
      </div>

      <div class="segment-details">
        <best-time segment="run.current_segment"></best-time>
      </div>
    </div>
  </body>

  <script>
    const $ = document.querySelectorAll.bind(document);

    const {Run, FileIO} = require('../lib');

    let context = {
      run: new Run()
    };

    // rivets.binders['best-segment'] = function(el, segment) {
    //   let new_value = 0;
    //   if(segment && segment.best_time) {
    //     new_value = segment.best_time;
    //     console.log(segment.best_time);
    //   }
    //   el.innerText = new_value;
    // };

    rivets.components['best-time'] = {
      template: function() {
        return '<span class="best-seg">Best: { segment.best_time | time }</span>';
      },

      initialize: function(el, data) {
        return data || { segment: { best_time: 0 } };
      }
    };

    let $view_bind = rivets.bind($('#wrap')[0], context);




    Mousetrap.bind('space', function() { context.run.start_or_resume(); });
    Mousetrap.bind('p', function() { context.run.pause(); });
    Mousetrap.bind('s', function() { context.run.stop(); });
    Mousetrap.bind('n', function() { context.run.split(); });
    Mousetrap.bind('r', function() { context.run.reset(); });
    Mousetrap.bind('m', function() { context.run.unsplit(); });
    Mousetrap.bind('mod+s', function() { FileIO.save_run(context.run); });
    Mousetrap.bind('mod+o', function() {
      context.run = FileIO.open_run();
    });
  </script>
</html>

